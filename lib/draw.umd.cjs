(function(l,h){typeof exports=="object"&&typeof module<"u"?module.exports=h():typeof define=="function"&&define.amd?define(h):(l=typeof globalThis<"u"?globalThis:l||self,l.draw=h())})(this,function(){"use strict";class l{constructor(t,e){this.cavans=t,this.ctx=e,this.painting=!1,this.lastPoint={x:void 0,y:void 0},this.initDrawEvent(),this.eventHookPool={}}initDrawEvent(){const t=this.cavans,e=this.ctx,o=this;t.onmousedown=function(n){this.painting=!0;let s=n.clientX,r=n.clientY;this.lastPoint={x:s,y:r},h(e,s,r,2),o.emitEventHook("mousedown")},t.onmousemove=function(n){if(this.painting){let s=n.clientX,r=n.clientY,a={x:s,y:r};o.drawLine(this.lastPoint.x,this.lastPoint.y,a.x,a.y),this.lastPoint=a}o.emitEventHook("mousemove")},t.onmouseup=function(){this.painting=!1,o.emitEventHook("mouseup")}}appendEventHook(t,e){this.eventHookPool[t]?this.eventHookPool[t].push(e):this.eventHookPool[t]=[e]}emitEventHook(t,...e){if(this.eventHookPool[t])return this.eventHookPool[t].every(o=>o.call(this,...e))}drawLine(t,e,o,n){this.ctx.lineWidth=3,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.emitEventHook("drawline",t,e,o,n)&&(this.ctx.moveTo(t,e),this.ctx.lineTo(o,n),this.ctx.stroke(),this.ctx.closePath())}}function h(i,t,e,o){i.save(),i.beginPath(),i.arc(t,e,o,0,Math.PI*2),i.fill()}const f={position:"absolute",boxSizing:"border-box",top:0,right:0,display:"flex",justifyContent:"space-between",width:"300px",padding:"20px",height:"100vh",background:"#888"};function c(i,t){Object.keys(t).forEach(e=>{i.style[e]=t[e]})}const u={width:"60px",lineHeight:"30px",height:"30px",background:"white",textAlign:"center",borderRadius:"6px",cursor:"default"};class x{constructor(){this.statePool={},this.stateCopy={}}addState(t,e){this.statePool[t]||(this.statePool[t]=e,this.stateCopy[t]=e)}initState(){Object.keys(this.stateCopy).forEach(t=>{this.statePool[t]=this.stateCopy[t]})}setState(t,e){this.initState(),this.statePool[t]=e}getState(t){return this.statePool[t]}}const d=new x;d.addState("isRubber",!1);const p={paint:{registered(i){const t=document.createElement("div");return t.innerHTML="画笔",c(t,u),t.onclick=function(){d.initState()},t}},rubber:{registered(i){const t=document.createElement("div");t.innerHTML="橡皮",c(t,u);const e=i.ctx,o=i.el,n=function(s,r,a,w){return d.getState("isRubber")?(e.save(),e.globalCompositeOperation="destination-out",e.moveTo(s,r),e.lineTo(a,w),e.stroke(),e.closePath(),e.clip(),e.clearRect(0,0,o.width,o.height),e.restore(),!1):!0};return i.drawEvent.appendEventHook("drawline",n),i.drawEvent.appendEventHook("mousedown",n),t.onclick=function(){d.setState("isRubber",!0)},t}},clear:{registered(i){const t=document.createElement("div");return t.innerHTML="清除",c(t,u),t.onclick=function(){const e=i.el;i.ctx.clearRect(0,0,e.width,e.height)},t}}};class v{constructor(t,e){this.root=t,this.extendsList=[],this.registerExtend(e),this.toolUi=document.createElement("div"),c(this.toolUi,f),this.render()}render(){this.extendsList.forEach(t=>{this.toolUi.appendChild(t)}),this.root.appendChild(this.toolUi)}registerExtend(t){Object.keys(p).forEach(e=>{this.extendsList.push(p[e].registered(t))})}}class m{constructor(t){this.options=t,this.root=null,this.el=null,this.ctx=null,this.tools=null,this.drawEvent=null,this.initCtx(),this.initDrawBoard(),this.initDrawEvent(),this.initTools()}initCtx(){const t=this.options.el;this.root=document.querySelector(t),this.el=document.createElement("canvas"),this.root.appendChild(this.el),this.ctx=this.el.getContext("2d");let e=document.documentElement.clientWidth,o=document.documentElement.clientHeight;this.el.width=e,this.el.height=o}initDrawBoard(){}initDrawEvent(){this.drawEvent=new l(this.el,this.ctx)}initTools(){this.tools=new v(this.root,this)}}return m});
//# sourceMappingURL=draw.umd.cjs.map
