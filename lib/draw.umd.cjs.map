{"version":3,"file":"draw.umd.cjs","sources":["../src/event/drawEvent.js","../src/style/toolStyle.js","../src/style/addStyle.js","../src/style/baseStyle.js","../src/tools/state/toolState.js","../src/tools/extends/rubber/rubber.js","../src/tools/extends/index.js","../src/tools/extends/paint/paint.js","../src/tools/extends/clear/clear.js","../src/tools/index.js","../src/main.js"],"sourcesContent":["// 绘制事件\r\nexport default class DrawEvent {\r\n  constructor(cavansEl, ctx) {\r\n    this.cavans = cavansEl;\r\n    this.ctx = ctx;\r\n    // 是否正在绘制中\r\n    this.painting = false;\r\n    // 保存上一次的绘制点位\r\n    this.lastPoint = { x: undefined, y: undefined };\r\n    this.initDrawEvent();\r\n    // 事件池\r\n    this.eventHookPool = {};\r\n  }\r\n  initDrawEvent() {\r\n    const canvas = this.cavans;\r\n    const ctx = this.ctx;\r\n    const vm = this;\r\n    //鼠标按下事件\r\n    canvas.onmousedown = function (e) {\r\n      this.painting = true;\r\n      let x = e.clientX;\r\n      let y = e.clientY;\r\n      this.lastPoint = { x: x, y: y };\r\n      drawCircle(ctx, x, y, 2);\r\n      vm.emitEventHook('mousedown');\r\n    };\r\n\r\n    //鼠标移动事件\r\n    canvas.onmousemove = function (e) {\r\n      if (this.painting) {\r\n        let x = e.clientX;\r\n        let y = e.clientY;\r\n        let newPoint = { x: x, y: y };\r\n        vm.drawLine(this.lastPoint.x, this.lastPoint.y, newPoint.x, newPoint.y);\r\n        this.lastPoint = newPoint;\r\n      }\r\n      vm.emitEventHook('mousemove');\r\n    };\r\n\r\n    //鼠标松开事件\r\n    canvas.onmouseup = function () {\r\n      this.painting = false;\r\n      vm.emitEventHook('mouseup');\r\n    };\r\n  }\r\n  // 注册新的绘制中事件\r\n  appendEventHook(event, callback) {\r\n    if (this.eventHookPool[event]) {\r\n      this.eventHookPool[event].push(callback);\r\n    } else {\r\n      this.eventHookPool[event] = [callback];\r\n    }\r\n  }\r\n  // 熔断钩子，执行对应的事件\r\n  emitEventHook(event, ...params) {\r\n    if (this.eventHookPool[event]) {\r\n      return this.eventHookPool[event].every((cb) => {\r\n        return cb.call(this, ...params);\r\n      });\r\n    }\r\n  }\r\n  // 绘制线条\r\n  drawLine(x1, y1, x2, y2) {\r\n    // 初始化线条，之后会做抽离\r\n    this.ctx.lineWidth = 3;\r\n    this.ctx.lineCap = 'round';\r\n    this.ctx.lineJoin = 'round';\r\n    // 利用熔断决定是否之后后续的绘制\r\n    if (!this.emitEventHook('drawline', x1, y1, x2, y2)) {\r\n      return;\r\n    }\r\n    this.ctx.moveTo(x1, y1);\r\n    this.ctx.lineTo(x2, y2);\r\n    this.ctx.stroke();\r\n    this.ctx.closePath();\r\n  }\r\n}\r\n\r\n// 绘制像素点\r\nfunction drawCircle(ctx, x, y, radius) {\r\n  ctx.save();\r\n  ctx.beginPath();\r\n  ctx.arc(x, y, radius, 0, Math.PI * 2);\r\n  ctx.fill();\r\n}\r\n","export const toolUiStyleSheet = {\r\n  position: 'absolute',\r\n  boxSizing: 'border-box',\r\n  top: 0,\r\n  right: 0,\r\n  display: 'flex',\r\n  justifyContent: 'space-between',\r\n  width: '300px',\r\n  padding: '20px',\r\n  height: '100vh',\r\n  background: '#888',\r\n};\r\n","// 给节点添加CSS属性\r\nexport function addStyle(el, styleSheet) {\r\n  Object.keys(styleSheet).forEach((key) => {\r\n    el.style[key] = styleSheet[key];\r\n  });\r\n}\r\n","export const BaseButtonStyleSheet = {\r\n  width: '60px',\r\n  lineHeight: '30px',\r\n  height: '30px',\r\n  background: 'white',\r\n  textAlign: 'center',\r\n  borderRadius: '6px',\r\n  cursor: 'default',\r\n};\r\n","// 目前仅考虑各种状态互斥的情况，之后可以考虑添加到多种状态共存\r\n// 工具栏状态管理工具\r\nclass ToolState {\r\n  constructor() {\r\n    this.statePool = {};\r\n    this.stateCopy = {};\r\n  }\r\n  addState(name, initValue) {\r\n    if (this.statePool[name]) {\r\n      return;\r\n    }\r\n    this.statePool[name] = initValue;\r\n    this.stateCopy[name] = initValue;\r\n  }\r\n  initState() {\r\n    Object.keys(this.stateCopy).forEach((key) => {\r\n      this.statePool[key] = this.stateCopy[key];\r\n    });\r\n  }\r\n  setState(name, value) {\r\n    this.initState();\r\n    this.statePool[name] = value;\r\n  }\r\n  getState(name) {\r\n    return this.statePool[name];\r\n  }\r\n}\r\n\r\nexport default new ToolState();\r\n","import { addStyle } from '../../../style/addStyle';\r\nimport { BaseButtonStyleSheet } from '../../../style/baseStyle';\r\nimport statePool from '../../state/toolState';\r\n// 注册新的工具状态\r\nstatePool.addState('isRubber', false);\r\n// 橡皮檫工具\r\nexport default {\r\n  /*  */\r\n  registered(vm) {\r\n    // 初始化UI\r\n    const buttton = document.createElement('div');\r\n    buttton.innerHTML = `橡皮`;\r\n    addStyle(buttton, BaseButtonStyleSheet);\r\n    const ctx = vm.ctx;\r\n    const canvas = vm.el;\r\n    const callBack = function (x1, y1, x2, y2) {\r\n      if (statePool.getState('isRubber')) {\r\n        // 利用canvas的裁剪实现擦除功能\r\n        ctx.save();\r\n        ctx.globalCompositeOperation = 'destination-out';\r\n        ctx.moveTo(x1, y1);\r\n        ctx.lineTo(x2, y2);\r\n        ctx.stroke();\r\n        ctx.closePath();\r\n        ctx.clip();\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n        ctx.restore();\r\n        return false;\r\n      }\r\n      return true;\r\n    };\r\n    // 添加到绘制事件中的钩子上\r\n    vm.drawEvent.appendEventHook('drawline', callBack);\r\n    vm.drawEvent.appendEventHook('mousedown', callBack);\r\n    // 添加点击事件，更改工具状态\r\n    buttton.onclick = function () {\r\n      statePool.setState('isRubber', true);\r\n    };\r\n    return buttton;\r\n  },\r\n};\r\n","import rubber from './rubber/rubber';\r\nimport clear from './clear/clear';\r\nimport paint from './paint/paint';\r\n// 所有默认插件，之后需要对位置进行配置化处理\r\nexport default {\r\n  paint,\r\n  rubber,\r\n  clear,\r\n};\r\n","import { addStyle } from '../../../style/addStyle';\r\nimport { BaseButtonStyleSheet } from '../../../style/baseStyle';\r\nimport statePool from '../../state/toolState';\r\n// 画笔工具\r\nexport default {\r\n  registered(vm) {\r\n    const buttton = document.createElement('div');\r\n    buttton.innerHTML = `画笔`;\r\n    addStyle(buttton, BaseButtonStyleSheet);\r\n    buttton.onclick = function () {\r\n      statePool.initState();\r\n    };\r\n    return buttton;\r\n  },\r\n};\r\n","import { addStyle } from '../../../style/addStyle';\r\nimport { BaseButtonStyleSheet } from '../../../style/baseStyle';\r\n// 清除工具\r\nexport default {\r\n  registered(vm) {\r\n    const buttton = document.createElement('div');\r\n    buttton.innerHTML = `清除`;\r\n    addStyle(buttton, BaseButtonStyleSheet);\r\n    buttton.onclick = function () {\r\n      const canvas = vm.el;\r\n      vm.ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n    };\r\n    return buttton;\r\n  },\r\n};\r\n","import { toolUiStyleSheet } from '../style/toolStyle';\r\nimport { addStyle } from '../style/addStyle';\r\nimport defaultExtends from './extends/index';\r\n// 工具栏\r\n// 这里使用扩展机制，利用扩展将各个工具进行解耦\r\nexport default class Tools {\r\n  constructor(root, vm) {\r\n    this.root = root;\r\n    this.extendsList = [];\r\n    this.registerExtend(vm);\r\n    this.toolUi = document.createElement('div');\r\n    addStyle(this.toolUi, toolUiStyleSheet);\r\n    this.render();\r\n  }\r\n  render() {\r\n    this.extendsList.forEach((extend) => {\r\n      this.toolUi.appendChild(extend);\r\n    });\r\n    this.root.appendChild(this.toolUi);\r\n  }\r\n  // 注册所有默认的功能扩展\r\n  registerExtend(vm) {\r\n    Object.keys(defaultExtends).forEach((extend) => {\r\n      this.extendsList.push(defaultExtends[extend].registered(vm));\r\n    });\r\n  }\r\n}\r\n","import DrawBoard from './board/index';\r\nimport DrawEvent from './event/drawEvent';\r\nimport Tools from './tools/index';\r\nexport default class Draw {\r\n  constructor(options) {\r\n    this.options = options;\r\n    this.root = null;\r\n    this.el = null;\r\n    this.ctx = null;\r\n    this.tools = null;\r\n    this.drawEvent = null;\r\n    this.initCtx();\r\n    this.initDrawBoard();\r\n    this.initDrawEvent();\r\n    this.initTools();\r\n  }\r\n  // 初始化上下文\r\n  initCtx() {\r\n    const ElName = this.options.el;\r\n    this.root = document.querySelector(ElName);\r\n    this.el = document.createElement('canvas');\r\n    this.root.appendChild(this.el);\r\n    this.ctx = this.el.getContext('2d');\r\n    let pageWidth = document.documentElement.clientWidth;\r\n    let pageHeight = document.documentElement.clientHeight;\r\n    this.el.width = pageWidth;\r\n    this.el.height = pageHeight;\r\n  }\r\n  // 初始化画板，之后需要在这里处理鼠标和画面的偏移问题\r\n  initDrawBoard() {\r\n    // this.drawBoard = new DrawBoard(this.options);\r\n  }\r\n  // 初始化绘制事件\r\n  initDrawEvent() {\r\n    this.drawEvent = new DrawEvent(this.el, this.ctx);\r\n  }\r\n  // 初始化工具栏\r\n  initTools() {\r\n    this.tools = new Tools(this.root, this);\r\n  }\r\n}\r\n"],"names":["DrawEvent","cavansEl","ctx","canvas","vm","e","x","y","drawCircle","newPoint","event","callback","params","cb","x1","y1","x2","y2","radius","toolUiStyleSheet","addStyle","el","styleSheet","key","BaseButtonStyleSheet","ToolState","name","initValue","value","statePool","defaultExtends","buttton","callBack","Tools","root","extend","Draw","options","ElName","pageWidth","pageHeight"],"mappings":"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"}